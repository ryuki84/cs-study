# 동기화(Synchronization), 락(Lock), 데드락(Deadlock)

## 1. 개념 정리

### 1-1. 동기화(Synchronization)
동기화란 **여러 스레드(또는 프로세스)가 공유 자원에 접근할 때  
실행 순서를 제어하여 데이터의 정합성을 보장하는 기법**이다.

멀티스레드 환경에서는 여러 실행 흐름이 동시에 동작하기 때문에,  
공유 자원에 대한 접근을 통제하지 않으면 데이터가 깨질 수 있다.

---

### 1-2. 락(Lock)
락은 동기화를 구현하기 위한 대표적인 수단으로,  
**특정 자원에 대해 한 번에 하나의 스레드만 접근하도록 제한**한다.

락을 획득한 스레드는 임계 영역(Critical Section)을 실행하고,  
작업이 끝난 후 락을 해제한다.

---

### 1-3. 데드락(Deadlock)
데드락은 **두 개 이상의 스레드(또는 프로세스)가  
서로가 가진 자원을 기다리며 무한 대기 상태에 빠지는 현상**이다.

데드락이 발생하면 외부 개입 없이는  
해당 스레드들이 영원히 실행되지 못한다.

---

## 2. 왜 중요한가
동기화 문제는 단순한 버그를 넘어 **서비스 장애**로 이어질 수 있다.

- 데이터 정합성 오류
- 트랜잭션 실패
- 서버 응답 지연 또는 멈춤 현상

특히 금융 시스템이나 대규모 트래픽 환경에서는  
락 설계 하나로 **성능과 안정성이 크게 갈린다**.

---

## 3. 백엔드 실무 관점

### 3-1. 동기화의 실무 예
Spring 기반 서버에서는 대부분의 Bean이 싱글톤이므로  
여러 스레드가 하나의 객체에 동시에 접근할 수 있다.

이때 인스턴스 변수에 상태를 두거나,  
공유 컬렉션을 동기화 없이 사용하는 경우 문제가 발생한다.

---

### 3-2. 락 사용 시 주의점
- 락 범위가 넓을수록 동시성 감소
- 락을 오래 잡을수록 응답 지연 증가
- 불필요한 락은 성능 병목의 원인이 된다

실무에서는:
- 락 범위를 최소화하고
- 가능하면 불변 객체 사용
- DB 트랜잭션 락과의 중첩도 고려해야 한다

---

### 3-3. 데드락 발생 사례
- 스레드 A: 락 1 → 락 2 요청
- 스레드 B: 락 2 → 락 1 요청

서로 상대가 가진 락을 기다리며  
무한 대기 상태가 된다.

---

## 4. 데드락 발생 조건 (Coffman 조건)
데드락은 아래 네 가지 조건이 **모두 충족될 때** 발생한다.

1. 상호 배제(Mutual Exclusion)  
2. 점유 대기(Hold and Wait)  
3. 비선점(No Preemption)  
4. 순환 대기(Circular Wait)

이 중 하나라도 깨지면 데드락은 발생하지 않는다.

---

## 5. 트레이드오프 / 주의사항
- 동기화를 강화하면 정합성은 좋아지지만 성능은 떨어진다
- 락을 줄이면 성능은 좋아지지만 버그 위험이 커진다

즉,
> **정합성 ↔ 성능 사이의 균형**이 핵심이다.

실무에서는:
- 비즈니스 중요 데이터만 동기화
- 락 순서 일관성 유지
- 타임아웃 기반 락 사용
같은 방식으로 리스크를 줄인다.

---

## 6. 예상 면접 질문 & 답변 연습

### Q1. 동기화가 왜 필요한가요?
A.  
멀티스레드 환경에서는 여러 실행 흐름이 동시에 공유 자원에 접근하므로  
동기화 없이는 데이터 정합성이 깨질 수 있기 때문에 필요합니다.

---

### Q2. 락을 많이 사용하면 왜 문제가 되나요?
A.  
락은 동시 접근을 제한하기 때문에  
과도하게 사용하면 스레드 대기 시간이 증가하고  
전체 처리량이 감소할 수 있습니다.

---

### Q3. 데드락이란 무엇이며, 언제 발생하나요?
A.  
데드락은 여러 스레드가 서로의 자원을 기다리며  
무한 대기 상태에 빠지는 현상입니다.  
상호 배제, 점유 대기, 비선점, 순환 대기 조건이 모두 만족될 때 발생합니다.

---

### Q4. 데드락을 예방하는 방법은 무엇인가요?
A.  
락 획득 순서를 일관되게 유지하거나,  
락 타임아웃을 사용하거나,  
가능하면 락을 사용하지 않는 구조로 설계해 예방할 수 있습니다.

---

## 7. 한 문장 요약 (면접용)
동기화와 락은 멀티스레드 환경에서 정합성을 보장하기 위한 수단이며,  
잘못 설계하면 데드락과 성능 저하로 이어질 수 있습니다.
