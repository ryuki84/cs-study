# Transaction Boundary Design (트랜잭션 경계 설계)

## 1. 개념 정리
트랜잭션 경계(Transaction Boundary)는
하나의 트랜잭션이 시작되고 종료되는 범위를 의미한다.

Spring에서는 @Transactional을 통해
메서드 단위로 트랜잭션 경계를 정의하며,
해당 범위 내에서 DB 커넥션과 락이 유지된다.

즉,
트랜잭션 경계는
단순한 코드 범위가 아니라
DB 커넥션, 락, 스레드 점유 범위를 함께 결정한다.

---

## 2. 왜 중요한가
트랜잭션 경계가 불필요하게 넓어지면:
- DB 커넥션 점유 시간 증가
- 락 유지 시간 증가
- 동시 처리량 감소
- 데드락 발생 가능성 증가

반대로 너무 좁으면:
- 정합성 보장 실패
- 부분 커밋/롤백 문제
- 보상 로직 증가

즉,
트랜잭션 경계 설계는
정합성과 성능 사이의 균형 문제다.

---

## 3. 백엔드 실무 관점
실무에서 권장되는 트랜잭션 경계 설계 원칙은 다음과 같다.

- 하나의 비즈니스 의미 단위로 트랜잭션 구성
- 외부 API 호출은 트랜잭션 밖에서 수행
- 트랜잭션 내부에서는 DB 작업만 집중 수행
- 불필요한 로직(변환, 검증)은 트랜잭션 외부로 이동

예를 들어:
- 주문 생성 + 결제 요청
  → 주문 생성까지만 트랜잭션
  → 결제 API 호출은 트랜잭션 외부

이렇게 설계하면
외부 시스템 지연이나 장애가
DB 락과 커넥션 점유로 확산되는 것을 방지할 수 있다.

---

## 4. 트레이드오프 / 주의사항
- 트랜잭션을 너무 쪼개면 보상 처리 복잡도 증가
- REQUIRES_NEW 남용 시 커밋 순서 문제 발생
- 트랜잭션 내부에서 sleep, 외부 호출은 매우 위험

즉,
> 트랜잭션은 “짧고 명확하게” 설계하고,
> 느린 작업은 반드시 밖으로 분리해야 한다.

라는 트레이드오프가 존재한다.

---

## 5. 예상 면접 질문 & 답변 연습

### Q1. 트랜잭션 경계를 넓게 잡으면 어떤 문제가 발생하나요?
A.
DB 커넥션과 락 점유 시간이 늘어나
동시 처리량이 감소하고,
데드락 발생 가능성이 높아집니다.

---

### Q2. 외부 API 호출을 트랜잭션 밖으로 빼는 이유는 무엇인가요?
A.
외부 시스템 지연이나 장애가
DB 트랜잭션과 커넥션 점유로 전파되는 것을
방지하기 위함입니다.

---

### Q3. 트랜잭션 경계 설계의 기준은 무엇인가요?
A.
비즈니스적으로 하나의 원자적 작업 단위를 기준으로,
정합성과 성능을 함께 고려해 설계합니다.

---

## 6. 한 문장 요약 (면접용)
트랜잭션 경계 설계는
DB 정합성을 지키면서도
커넥션과 락 점유를 최소화하는 것이 핵심이다.
